var content=function(){"use strict";var y=Object.defineProperty;var L=(a,i,l)=>i in a?y(a,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[i]=l;var c=(a,i,l)=>L(a,typeof i!="symbol"?i+"":i,l);var f,E;const i=(E=(f=globalThis.browser)==null?void 0:f.runtime)!=null&&E.id?globalThis.browser:globalThis.chrome;function l(e){return e}function I(){const e=i.runtime.getURL("opencv/4.12.0/opencv.js"),t=i.runtime.getURL("opencv/4.12.0/");window.addEventListener("message",r=>{r.source===window&&r.data.type==="GET_OPENCV_URLS"&&window.postMessage({type:"OPENCV_URLS_RESPONSE",urls:{opencvJs:e,wasmBase:t}},"*")});const n=document.createElement("script");n.src=i.runtime.getURL("opencv-injector.js"),n.async=!0,n.defer=!0,n.onload=()=>{console.log("OpenCV injector script loaded successfully.")},n.onerror=r=>{console.error("Failed to load OpenCV injector script",r)},(document.head||document.documentElement).appendChild(n)}function b(){const e=document.createElement("script");e.src=i.runtime.getURL("watermark-pipeline.js"),e.async=!0,e.defer=!0,e.onload=()=>{console.log("Watermark pipeline script loaded successfully.")},e.onerror=t=>{console.error("Failed to load watermark pipeline script",t)},(document.head||document.documentElement).appendChild(e)}function T(){const e=document.createElement("script");e.src=i.runtime.getURL("fetch-interceptor.js"),e.async=!0,e.defer=!0,e.onload=()=>{console.log("Fetch interceptor script loaded successfully.")},e.onerror=t=>{console.error("Failed to load fetch interceptor script",t)},(document.head||document.documentElement).appendChild(e)}document.addEventListener("opencvReady",e=>{console.log("OpenCV is ready to use!",e.detail)}),b(),I(),T();const C={matches:["*://gemini.google.com/*"],main(){console.log("Gemini Watermark Cleaner content script loaded.")}};function u(e,...t){}const N={debug:(...e)=>u(console.debug,...e),log:(...e)=>u(console.log,...e),warn:(...e)=>u(console.warn,...e),error:(...e)=>u(console.error,...e)},m=class m extends Event{constructor(t,n){super(m.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}};c(m,"EVENT_NAME",g("wxt:locationchange"));let h=m;function g(e){var t;return`${(t=i==null?void 0:i.runtime)==null?void 0:t.id}:content:${e}`}function F(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let r=new URL(location.href);r.href!==n.href&&(window.dispatchEvent(new h(r,n)),n=r)},1e3))}}}const d=class d{constructor(t,n){c(this,"isTopFrame",window.self===window.top);c(this,"abortController");c(this,"locationWatcher",F(this));c(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return i.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const r=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(t,n){const r=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(t){const n=requestAnimationFrame((...r)=>{this.isValid&&t(...r)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const r=requestIdleCallback((...o)=>{this.signal.aborted||t(...o)},n);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(t,n,r,o){var s;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(s=t.addEventListener)==null||s.call(t,n.startsWith("wxt:")?g(n):n,r,{...o,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),N.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:d.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var s,w,S;const n=((s=t.data)==null?void 0:s.type)===d.SCRIPT_STARTED_MESSAGE_TYPE,r=((w=t.data)==null?void 0:w.contentScriptName)===this.contentScriptName,o=!this.receivedMessageIds.has((S=t.data)==null?void 0:S.messageId);return n&&r&&o}listenForNewerScripts(t){let n=!0;const r=o=>{if(this.verifyScriptStartedEvent(o)){this.receivedMessageIds.add(o.data.messageId);const s=n;if(n=!1,s&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};c(d,"SCRIPT_STARTED_MESSAGE_TYPE",g("wxt:content-script-started"));let v=d;function U(){}function p(e,...t){}const R={debug:(...e)=>p(console.debug,...e),log:(...e)=>p(console.log,...e),warn:(...e)=>p(console.warn,...e),error:(...e)=>p(console.error,...e)};return(async()=>{try{const{main:e,...t}=C,n=new v("content",t);return await e(n)}catch(e){throw R.error('The content script "content" crashed on startup!',e),e}})()}();
content;
